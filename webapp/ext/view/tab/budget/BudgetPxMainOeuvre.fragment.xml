<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:table="sap.ui.table"
    xmlns:f="sap.ui.layout.form"
    xmlns:rm="sap.ui.table.rowmodes"
>
    <table:TreeTable
        class="budgetMainOeuvreTab"
        id="BudgetPxMainOeuvreTreeTableId"
        rows="{
            path: 'utilities>/pxMainOeuvreHierarchy',
            parameters: {
                arrayNames: ['children'],
                numberOfExpandedLevels: 3
            }
        }"
        selectionMode="None"
        ariaLabelledBy="title"
        enableColumnReordering="false"
        fixedColumnCount="1"
        rowsUpdated="onRowsUpdatedBudgetPXMainOeuvreTab"
    >
        <table:rowMode>
            <rm:Auto minRowCount= "{localModel>/tableSettings/minRowCount}" />
        </table:rowMode>
        <table:extension>
            <Toolbar class="sapMTBHeader-CTX">
                <ToolbarSpacer />
                <Button
                    text="{i18n>btn.addMOProfil}"
                    icon="sap-icon://add"
                    press="onBtnAddMOProfilPress"
                    type="Emphasized"
                    visible="{ui>/editable}"
                />
            </Toolbar>
        </table:extension>
        <!-- <table:rowSettingsTemplate>
            <table:RowSettings
                highlight="{= ${budget>Status} === 'Non acquis' ? 'Error' : 'None'}"
            />
        </table:rowSettingsTemplate> -->
        <table:columns>
            <table:Column width="17rem" hAlign= "Center" >
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.missionHiearchie}" />
                </table:multiLabels>
                <table:template>
                    <VBox>
                        <Text text="{utilities>name}" />
                    </VBox>
                </table:template>
            </table:Column>

            <table:Column width="4rem" headerSpan="6,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.missionCode}" />
                </table:multiLabels>
                <table:template>
                    <Text text="{utilities>code}" />
                </table:template>
            </table:Column>

            <table:Column width="5rem" headerSpan="6,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.missionLibelle}" />
                </table:multiLabels>
                <table:template>
                    <Text text="{utilities>libelle}" />
                </table:template>
            </table:Column>
            <table:Column width="4rem" headerSpan="6,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.missionStatus}" />
                </table:multiLabels>
                <table:template>
                    <Text text="{utilities>status}" />
                </table:template>
            </table:Column>

            <!-- <table:Column width="7rem" headerSpan="6,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.montant}" />
                </table:multiLabels>
                <table:template>
                <HBox visible="{= !!${utilities>isBudget} || !!${utilities>isTotal} }">
                    <Text   text="{utilities>montant}" visible="{= !${ui>/editable} || !!${utilities>isTotal} }"/>
                    <Input  
                        value="{utilities>montant}" 
                        visible="{= ${ui>/editable} &amp;&amp; !!${utilities>isBudget} }"
                        change="onChangeRecetteExtMontant"
                    />
                </HBox>
                </table:template>
            </table:Column> -->

            <table:Column width="6rem" headerSpan="6,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.startDate}" />
                </table:multiLabels>
                <table:template>
                    <HBox>
                        <Text
                            text="{
                                path: 'utilities>startDate',
                                type: 'sap.ui.model.type.Date',
                                formatOptions: { 
                                    style: 'short',
                                    strictParsing: true
                                }
                            }"
                        />
                        <!-- visible="{= !${utilities>isNode} &amp;&amp; !${utilities>isTotalRow}}" -->
                    </HBox>
                </table:template>
            </table:Column>
            <table:Column width="6rem" headerSpan="6,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.endDate}" />
                </table:multiLabels>
                <table:template>
                    <HBox>
                        <Text
                            text="{
                                path: 'utilities>endDate',
                                type: 'sap.ui.model.type.Date',
                                formatOptions: { 
                                    style: 'short',
                                    strictParsing: true
                                }
                            }"
                        />
                        <!-- visible="{= !${utilities>isNode} &amp;&amp; !${utilities>isTotalRow}}" -->
                    </HBox>
                </table:template>
            </table:Column>

            <!-- Nombre Mois -->
            <table:Column width="7rem" headerSpan="6,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.nbMois}" />
                </table:multiLabels>
                <table:template>
                <HBox>
                    <Text text="{
                        parts: [
                            { path: 'utilities>startDate' },
                            { path: 'utilities>endDate' }
                        ], 
                        formatter:'.Formatter.formatNbMois' 
                    }" />
                </HBox>
                </table:template>
            </table:Column>

            <!-- Cumul -->
            <table:Column width="8rem" headerSpan="1,1,1" hAlign= "End">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.profil}" />
                    <Label text="{i18n>budget.main.oeuvre.tx.journ}" />
                    <Label text="{i18n>budget.main.oeuvre.cumul}" />
                </table:multiLabels>
                <table:template>
                <HBox>
                    <Text text="{
                        path: 'utilities>cumul',
                        type: 'sap.ui.model.type.Float', 
                        formatOptions: { 
                            minFractionDigits: 2, 
                            maxFractionDigits: 2, 
                            groupingEnabled: true, 
                            decimalSeparator: ',' 
                        }
                    }"/>
                </HBox>
                </table:template>
            </table:Column>
            

            <!-- Avenir
            <table:Column width="7rem" headerSpan="1,1,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.avenir}" />
                </table:multiLabels>
                <table:template>
                    <HBox>
                        <Text   text="{utilities>avenir}"/>
                    </HBox>
                </table:template>
            </table:Column>

            <table:Column width="7rem" headerSpan="1,1,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.fin.affaire}" />
                </table:multiLabels>
                <table:template>
                    <HBox>
                        <Text   text="{utilities>interUfo}"/>
                    </HBox>
                </table:template>
            </table:Column>

            <table:Column width="7rem" headerSpan="3,1,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.real}" />
                </table:multiLabels>
                <table:template>
                    <HBox>
                        <Text   text="{utilities>intraUfo}"/>
                    </HBox>
                </table:template>
            </table:Column>

            <table:Column width="7rem" headerSpan="3,1,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.physique}" />  
                </table:multiLabels>
                <table:template>
                    <HBox>
                        <Text   text="{utilities>cumuleEur}"/>
                    </HBox>
                </table:template>
            </table:Column>

            <table:Column width="7rem" headerSpan="3,1,1" hAlign= "Center">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="" />
                    <Label text="{i18n>budget.main.oeuvre.ecart}" />
                </table:multiLabels>
                <table:template>
                    <HBox>
                        <Text 
                            text="{
                                parts: [
                                    { path: 'utilities>montant' },
                                    { path: 'utilities>cumuleEur' }
                                ], 
                                formatter:'.Formatter.formatCumulePercent' 
                            }"
                            visible="{= !!${utilities>isBudget} || !!${utilities>isTotal} }"/>
                    </HBox>
                </table:template>
            </table:Column> -->

        </table:columns>
    </table:TreeTable>
</core:FragmentDefinition>
