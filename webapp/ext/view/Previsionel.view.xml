<mvc:View
    xmlns:core="sap.ui.core"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns:table="sap.ui.table"
    xmlns:rm="sap.ui.table.rowmodes"
    xmlns:layout="sap.ui.layout"
    xmlns:fb="sap.ui.comp.filterbar"
    controllerName="com.avv.ingerop.ingeropfga.ext.controller.extendOP"
>
    <VBox
        width="100%"
        class=""
        renderType="Bare"
    >
        <!-- ===== FILTER BAR (classic, comp) ===== -->
        <fb:FilterBar
            id="filterBar"
            showGoOnFB="true"
            showClearOnFB="false"
            showRestoreButton="false"
            search=".onSearchPrevisionel"
            filterBarExpanded="true"
        >
            <!-- Use filterGroupItems  -->
            <fb:filterGroupItems>
                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="Period"
                    label="Période MMyyyy"
                    visibleInFilterBar="true"
                    mandatory="true"
                >
                    <fb:control>
                        <Input
                            value="{filtersModel>/Period}"
                            placeholder="MMYYYY"
                            width="8rem"
                            liveChange=".onPeriodLiveChange"
                        />
                    </fb:control>
                </fb:FilterGroupItem>

                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="BusinessNo"
                    label="N°Affaire"
                    visibleInFilterBar="true"
                >
                    <fb:control>
                        <Input
                            value="{filtersModel>/Affaire}"
                            showValueHelp="true"
                            valueHelpRequest=".onBusinessNoValueHelp"
                            showSuggestion="true"
                            showClearIcon="true"
                            suggestionItems="{
                path: '/ZC_FGA_VH',
                sorter: { path: 'BusinessNo' }
            }"
                        >
                            <suggestionItems>
                                <core:Item text="{BusinessNo}" />
                            </suggestionItems>
                        </Input>
                    </fb:control>
                </fb:FilterGroupItem>

                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="UFO"
                    label="UFO Délégué"
                    visibleInFilterBar="true"
                >
                    <fb:control>
                        <Input
                            value="{filtersModel>/UFO}"
                            showValueHelp="true"
                            valueHelpRequest=".onUFOValueHelp"
                            showClearIcon="true"
                            showSuggestion="true"
                            suggestionItems="{
                path: '/ZI_FGA_UFO_VH',
                sorter: { path: 'UFO' }
            }"
                        >
                            <suggestionItems>
                                <core:Item text="{UFO}" />
                            </suggestionItems>
                        </Input>
                    </fb:control>
                </fb:FilterGroupItem>

                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="Label"
                    label="Libellé"
                    visibleInFilterBar="true"
                >
                    <fb:control>
                        <Input value="{filtersModel>/Label}" />
                    </fb:control>
                </fb:FilterGroupItem>

                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="Societe"
                    label="Société"
                    visibleInFilterBar="true"
                >
                    <fb:control>
                        <Input
                            value="{filtersModel>/Societe}"
                            showValueHelp="true"
                            valueHelpRequest=".onCompanyValueHelp"
                            showSuggestion="true"
                            showClearIcon="true"
                            suggestionItems="{
                path: '/I_CompanyCodeVH',
                sorter: { path: 'CompanyCode' }
            }"
                        >
                            <suggestionItems>
                                <core:Item text="{CompanyCode}" />
                            </suggestionItems>
                        </Input>
                    </fb:control>
                </fb:FilterGroupItem>

                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="ProfitCenter"
                    label="Centre de profit"
                    visibleInFilterBar="true"
                >
                    <fb:control>
                        <Input
                            value="{filtersModel>/ProfitCenter}"
                            showValueHelp="true"
                            valueHelpRequest=".onProfitCenterValueHelp"
                            showSuggestion="true"
                            showClearIcon="true"
                            suggestionItems="{
                path: '/ZI_FGA_PROFITCENTER_VH',
                sorter: { path: 'ProfitCenter' }
            }"
                        >
                            <suggestionItems>
                                <core:Item text="{ProfitCenter}" />
                            </suggestionItems>
                        </Input>
                    </fb:control>
                </fb:FilterGroupItem>

                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="BusinessManager"
                    label="Business Manager"
                    visibleInFilterBar="false"
                >
                    <fb:control>
                        <Input value="{filtersModel>/BusinessManager}" />
                    </fb:control>
                </fb:FilterGroupItem>

                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="ChefProjet"
                    label="Chef de projet"
                    visibleInFilterBar="false"
                >
                    <fb:control>
                        <Input value="{filtersModel>/ChefProjet}" />
                    </fb:control>
                </fb:FilterGroupItem>

                <fb:FilterGroupItem
                    groupName="_BASIC"
                    name="STIsLiees"
                    label="STIs Liées"
                    visibleInFilterBar="false"
                >
                    <fb:control>
                        <Input value="{filtersModel>/STIsLiees}" />
                    </fb:control>
                </fb:FilterGroupItem>
            </fb:filterGroupItems>
        </fb:FilterBar>

        <!-- ===== TREE TABLE BELOW ===== -->
        <table:TreeTable
            id="PrevisionnelTreeTable"
            width="100%"
            rowsUpdated="onRowsUpdatedBudgetPXTab"
            class="sapUiMediumMarginTop"
            rows="{
            path: 'utilities>/previsionelHierarchyWithTotals',
            parameters: {
                arrayNames: ['children'],
                numberOfExpandedLevels: 0
            }
        }"
            selectionMode="None"
            ariaLabelledBy="title"
            enableColumnReordering="false"
            enableColumnFreeze="true"
            fixedColumnCount="1"
        >
            <table:extension>
                <MessageStrip
                    text="{= ${utilities>/DataMode} === 'M'
            ? 'Mode manuel : ce tableau comporte des valeurs saisies manuellement..'
            : 'Mode automatique : les valeurs dans ce tableau sont calculées automatiquement.'}"
                    type="{= ${utilities>/DataMode} === 'M' ? 'Information' : 'Warning'}"
                    showIcon="true"
                    showCloseButton="false"
                />
            </table:extension>

            <!--table:rowMode>
                <rm:Auto
                    minRowCount="{localModel>/tableSettings/minRowCountPrev}"
                />
            </table:rowMode-->

            <table:rowMode>
                <rm:Interactive
                    rowCount="15"
                    minRowCount="5"
                />
            </table:rowMode>

            <table:columns>
                <!-- === Colonne Hiérarchique (comme PxAutre) === -->
                <!--table:Column width="17rem">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="Hierarchy/Mission" />
                </table:multiLabels>
                <table:template>
                    <Text
                        text="{= ${utilities>isTotalRow} ? ${utilities>name} : 
                                 ${utilities>isNode} ? ${utilities>name} : 
                                 ${utilities>MissionId}}"
                    />
                </table:template>
            </table:Column-->
                <table:Column width="23rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="Hierarchy/Mission" />
                    </table:multiLabels>
                    <table:template>
                        <!--Text
                        text="{= ${utilities>isTotalRow} ? ${utilities>name} : 
                                 ${utilities>isSectionHeader} ? ${utilities>name} :
                                 ${utilities>isL2} ? ${utilities>name} :
                                 ${utilities>isL1} ? ${utilities>name} :
                                 ${utilities>isL0} ? ${utilities>name} : 
                                 ${utilities>MissionId}}"
                    /-->
                        <!--Text text="{utilities>name}" /-->
                        <HBox alignItems="Center">
                            <items>
                                <ObjectStatus
                                    text="{utilities>name}"
                                    icon="{= (${utilities>isFactDepGroup} || ${utilities>isRegroupement} || 
                                        (!${utilities>isNode} &amp;&amp; !${utilities>isTotalRow})) &amp;&amp;
                                        !${utilities>isMission}
                                        ? (${utilities>DataMode} === 'M' 
                                            ? 'sap-icon://edit' 
                                            : 'sap-icon://action-settings') 
                                        : ''
                                    }"
                                    state="{= ${utilities>DataMode} === 'M' ? 'Information' : 'None'}"
                                />
                            </items>
                        </HBox>
                    </table:template>
                </table:Column>

                <!-- === Base columns === -->
                <table:Column width="12rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="Libellé affaire" />
                    </table:multiLabels>
                    <table:template>
                        <Text
                            text="{utilities>Description}"
                            visible="{= !${utilities>isTotalRow}}"
                        />
                    </table:template>
                </table:Column>

                <!--table:Column width="9rem">
                <table:multiLabels>
                    <Label text="" />
                    <Label text="Facturation / Dépenses" />
                </table:multiLabels>
                <table:template>
                    <ObjectStatus
                        text="{utilities>FacturationDepense}"
                        state="{= ${utilities>FacturationDepense} === 'Facturation' ? 'Success' : 'Warning'}"
                        icon="{= ${utilities>FacturationDepense}
                            ? (${utilities>FacturationDepense} === 'Facturation'
                                ? 'sap-icon://money-bills'
                                : 'sap-icon://expense-report')
                            : '' }"
                        visible="{= !${utilities>isTotalRow} &amp;&amp; (!${utilities>isNode} || ${utilities>isL0})}"
                    />
                </table:template>
            </table:Column-->

                <table:Column width="9rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="Facturation / Dépenses" />
                    </table:multiLabels>
                    <table:template>
                        <ObjectStatus
                            text="{utilities>FacturationDepense}"
                            state="{= ${utilities>FacturationDepense} === 'Facturation' ? 'Success' : 'Warning'}"
                            icon="{= ${utilities>FacturationDepense}
                ? (${utilities>FacturationDepense} === 'Facturation'
                    ? 'sap-icon://money-bills'
                    : 'sap-icon://expense-report')
                : '' }"
                            visible="{= (${utilities>isFactDepGroup} || ${utilities>isRegroupement} || (!${utilities>isNode} &amp;&amp; !${utilities>isTotalRow})) 
                      &amp;&amp; !${utilities>isMission}}"
                        />
                    </table:template>
                </table:Column>

                <table:Column width="8rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="Reste à facturer" />
                    </table:multiLabels>
                    <table:template>
                        <Text
                            text="{utilities>ResteAFacturer}"
                            visible="{= !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp; parseFloat(${utilities>ResteAFacturer}) !== 0}"
                        />
                    </table:template>
                </table:Column>

                <table:Column width="8rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="Reste à dépenser" />
                    </table:multiLabels>
                    <table:template>
                        <Text
                            text="{utilities>ResteADepenser}"
                            visible="{= !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp; parseFloat(${utilities>ResteADepenser}) !== 0}"
                        />
                    </table:template>
                </table:Column>

                <!-- === Année N (2025) === -->
                <table:Column
                    width="7rem"
                    headerSpan="12,1"
                    hAlign="Center"
                >
                    <table:multiLabels>
                        <Label text="ANNÉE EN COURS" />
                        <Label text="{= 'Janv ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>JanvN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <!--Input
                            value="{utilities>JanvN}"
                            submit=".onPrevisionelSubmit"
                            editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableJanvN} }"
visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"                        /-->
                            <Input
                                value="{utilities>JanvN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableJanvN} }"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableJanvN} &amp;&amp; 1 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Janv ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Févr ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>FevrN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="boldText"
                            />
                            <Input
                                value="{utilities>FevrN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableFevrN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableFevrN} &amp;&amp; 2 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Fevr ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Mars ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>MarsN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>MarsN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableMarsN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableMarsN} &amp;&amp; 3 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Mars ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Avr ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>AvrN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>AvrN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableAvrN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableAvrN} &amp;&amp; 4 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Avr ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Mai ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>MaiN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>MaiN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableMaiN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableMaiN} &amp;&amp; 5 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Mai ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Juin ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>JuinN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>JuinN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableJuinN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableJuinN} &amp;&amp; 6 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Juin ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Juil ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>JuilN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>JuilN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableJuilN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableJuilN} &amp;&amp; 7 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Juil ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <!-- === Editable fields (Août → Déc N) === -->
                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Août ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>AoutN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>AoutN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableAoutN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableAoutN} &amp;&amp; 8 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Aout ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Sept ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>SeptN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>SeptN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableSeptN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableSeptN} &amp;&amp; 9 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Sept ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Oct ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>OctN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>OctN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableOctN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableOctN} &amp;&amp; 10 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Oct ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Nov ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>NovN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>NovN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableNovN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableNovN} &amp;&amp; 11 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Nov ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Déc ' + ${utilities>/currentYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>DecN}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>DecN}"
                                submit=".onPrevisionelSubmit"
                                editable="{= ${ui>/editable} &amp;&amp; ${utilities>isEditableDecN}}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                            />
                            <ObjectStatus
                                text=""
                                state="Information"
                                icon="sap-icon://information"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader} &amp;&amp;
                                !${utilities>isEditableDecN} &amp;&amp; 12 &gt;= ${utilities>/periodMonth} }"
                                tooltip="{= 'Prévisionel Dec ' + ${utilities>/currentYear}}"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <!-- === Année N+1 (2026) — all editable === -->
                <!-- === Année N+1 (2026) === -->
                <table:Column
                    width="7rem"
                    headerSpan="12,1"
                    hAlign="Center"
                >
                    <table:multiLabels>
                        <Label text="ANNÉE N+1" />
                        <Label text="{= 'Janv ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>JanvN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>JanvN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Févr ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>FevrN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>FevrN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Mars ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>MarsN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>MarsN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Avr ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>AvrN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>AvrN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Mai ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>MaiN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>MaiN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Juin ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>JuinN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>JuinN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Juil ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>JuilN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>JuilN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Août ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>AoutN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>AoutN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Sept ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>SeptN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>SeptN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Oct ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>OctN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>OctN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Nov ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>NovN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>NovN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Déc ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <HBox>
                            <Text
                                text="{utilities>DecN1}"
                                visible="{= ${utilities>isTotalRow}}"
                                class="{= 'sapMTextStrong' }"
                            />
                            <Input
                                value="{utilities>DecN1}"
                                visible="{= !${utilities>isTotalRow} &amp;&amp; !${utilities>isNode} &amp;&amp; !${utilities>isSectionHeader}}"
                                editable="{ui>/editable}"
                                submit=".onPrevisionelSubmit"
                            />
                        </HBox>
                    </table:template>
                </table:Column>

                <!-- Totaux -->
                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label
                            text="{= 'Total ' + ${utilities>/currentYear}}"
                        />
                    </table:multiLabels>
                    <table:template>
                        <Text
                            text="{utilities>TotalN}"
                            visible="{= (!${utilities>isNode} || ${utilities>isL0})}"
                        />
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="{= 'Total ' + ${utilities>/nextYear}}" />
                    </table:multiLabels>
                    <table:template>
                        <Text
                            text="{utilities>TotalN1}"
                            visible="{= (!${utilities>isNode} || ${utilities>isL0})}"
                        />
                    </table:template>
                </table:Column>

                <table:Column width="7rem">
                    <table:multiLabels>
                        <Label text="" />
                        <Label text="Au-dela" />
                    </table:multiLabels>
                    <table:template>
                        <Text
                            text="{utilities>Audela}"
                            visible="{= (!${utilities>isNode} || ${utilities>isL0})}"
                        />
                    </table:template>
                </table:Column>
            </table:columns>
        </table:TreeTable>
    </VBox>
</mvc:View>
